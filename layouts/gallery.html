{{ define "title" }}{{ .Title }} | {{ .Site.Title }}{{ end }}

{{ define "main" }}
<div class="container">
  <header class="page-header">
    <h1>{{ .Title }}</h1>
    <p class="lead">{{ .Param "description" | default .Summary }}</p>
    <div class="gallery-filters">
      <div class="filter-group">
        <label for="search-filter" class="filter-label">Pesquisar</label>
        <input type="search" id="search-filter" class="search-filter" placeholder="Nome do Pok√©mon..." aria-label="Pesquisar por nome" autocomplete="off">
      </div>
      <div class="filter-group">
        <label for="gen-filter" class="filter-label">Gera√ß√£o</label>
        <select id="gen-filter" class="gen-filter" aria-label="Filtrar por gera√ß√£o">
      <option value="1" selected>Gera√ß√£o 1 (Kanto)</option>
      <option value="2">Gera√ß√£o 2 (Johto)</option>
      <option value="3">Gera√ß√£o 3 (Hoenn)</option>
      <option value="4">Gera√ß√£o 4 (Sinnoh)</option>
      <option value="5">Gera√ß√£o 5 (Unova)</option>
      <option value="6">Gera√ß√£o 6 (Kalos)</option>
      <option value="7">Gera√ß√£o 7 (Alola)</option>
      <option value="8">Gera√ß√£o 8 (Galar)</option>
      <option value="9">Gera√ß√£o 9 (Paldea)</option>
    </select>
      </div>
      <div class="filter-group">
        <label for="state-filter" class="filter-label">Estado</label>
        <select id="state-filter" class="gen-filter state-filter" aria-label="Filtrar por estado">
          <option value="all">Todos</option>
          <option value="done">J√° feitos</option>
          <option value="soon">Em breve</option>
        </select>
      </div>
    </div>
  </header>

  <div class="pokemon-grid">
    {{ $whatsapp := .Site.Params.whatsapp_number }}
    {{ range site.Data.pokemon }}
      {{ $id := int .id }}
      {{ $gen := cond (ge $id 906) 9 (cond (ge $id 810) 8 (cond (ge $id 722) 7 (cond (ge $id 650) 6 (cond (ge $id 494) 5 (cond (ge $id 387) 4 (cond (ge $id 252) 3 (cond (ge $id 152) 2 1))))))) }}
      {{ $imgPath := printf "%03d/1.jpg" $id }}
      {{ $imgURL := $imgPath | absURL }}
      {{ $hasImage := eq .image true }}

      <article class="pokemon-card {{ if not $hasImage }}pokemon-card--placeholder{{ end }}" data-generation="{{ $gen }}" data-name="{{ lower .name }}" data-done="{{ if $hasImage }}true{{ else }}false{{ end }}">
        <div class="pokemon-card__media">
          {{ if $hasImage }}
            <img src="{{ $imgURL }}" alt="{{ .name }}" class="pokemon-card__img" loading="lazy" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
            <div class="pokemon-card__placeholder pokemon-card__placeholder--fallback" style="display:none" aria-hidden="true">
              <span class="pokemon-card__silhouette"></span>
              <span class="pokemon-card__name-placeholder">{{ .name }}</span>
            </div>
            <span class="badge badge--done">J√° feito</span>
          {{ else }}
            <div class="pokemon-card__placeholder" aria-hidden="true">
              <span class="pokemon-card__silhouette"></span>
              <span class="pokemon-card__name-placeholder">{{ .name }}</span>
            </div>
            <span class="badge badge--soon">Em breve</span>
          {{ end }}
        </div>
        <div class="pokemon-card__body">
          <div class="pokemon-card__header">
            <h2 class="pokemon-card__title">{{ .name }}</h2>
            <span class="pokemon-card__price {{ if not (or .price .valor) }}pokemon-card__price--tbd{{ end }}">
              {{ if .price }}{{ .price }}{{ else }}{{ if .valor }}{{ .valor }}{{ else }}Valor a definir{{ end }}{{ end }}
            </span>
          </div>
          <p class="pokemon-card__id">#{{ printf "%03d" $id }}</p>
          <a href="https://wa.me/{{ $whatsapp }}?text=Ol√°! Vi o Pok√©mon {{ .name }} no teu site üôÇ" class="btn btn-whatsapp" target="_blank" rel="noopener">Contactar no WhatsApp</a>
        </div>
      </article>
    {{ end }}
  </div>

  {{ .Content }}
</div>

<script>
(function() {
  var select = document.getElementById('gen-filter');
  var search = document.getElementById('search-filter');
  var stateSelect = document.getElementById('state-filter');
  var grid = document.querySelector('.pokemon-grid');
  if (!select || !grid) return;
  var cards = grid.querySelectorAll('.pokemon-card');
  function filter() {
    var gen = select.value;
    var state = stateSelect ? stateSelect.value : 'all';
    var q = (search && search.value) ? search.value.trim().toLowerCase() : '';
    cards.forEach(function(card) {
      var matchGen = card.getAttribute('data-generation') === gen;
      var matchSearch = !q || (card.getAttribute('data-name') || '').indexOf(q) !== -1;
      var done = card.getAttribute('data-done') === 'true';
      var matchState = state === 'all' || (state === 'done' && done) || (state === 'soon' && !done);
      card.style.display = matchGen && matchSearch && matchState ? '' : 'none';
    });
  }
  filter();
  select.addEventListener('change', filter);
  if (stateSelect) stateSelect.addEventListener('change', filter);
  if (search) {
    search.addEventListener('input', filter);
    search.addEventListener('search', filter);
  }
})();
</script>
{{ end }}


