{{ define "title" }}{{ .Site.Title }}{{ end }}

{{ define "main" }}
<div class="hero">
  <div class="container">
    <h1>{{ .Title }}</h1>
    <p class="lead">{{ .Param "description" | default .Summary }}</p>
    <a href="{{ .Site.BaseURL }}gallery/" class="btn btn-primary">Ver Cole√ß√£o</a>
  </div>
</div>

{{ $whatsapp := .Site.Params.whatsapp_number }}
{{ $scratch := newScratch }}
{{ range site.Data.pokemon }}
  {{ if or (eq .image true) (eq .available true) }}
    {{ $scratch.Add "done" (slice .) }}
  {{ end }}
{{ end }}
{{ $done := $scratch.Get "done" }}
{{ if $done }}
<section class="container featured-section">
  <h2 class="featured-title">J√° feitos</h2>
  <div class="pokemon-grid">
    {{ range first 4 (shuffle $done) }}
      {{ $id := int .id }}
      {{ $hasImage := eq .image true }}
      {{ $isAvailable := eq .available true }}
      {{ $imgURL := printf "%03d/1.jpg" $id | absURL }}
      <article class="pokemon-card {{ if not $hasImage }}pokemon-card--placeholder{{ end }}">
        <div class="pokemon-card__media">
          {{ if $hasImage }}
            <img src="{{ $imgURL }}" alt="{{ .name }}" class="pokemon-card__img" loading="lazy" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
            <div class="pokemon-card__placeholder pokemon-card__placeholder--fallback" style="display:none" aria-hidden="true">
              <span class="pokemon-card__silhouette"></span>
              <span class="pokemon-card__name-placeholder">{{ .name }}</span>
            </div>
            <span class="badge badge--done">J√° feito</span>
          {{ else }}
            <div class="pokemon-card__placeholder" aria-hidden="true">
              <span class="pokemon-card__silhouette"></span>
              <span class="pokemon-card__name-placeholder">{{ .name }}</span>
            </div>
            <span class="badge badge--available">Dispon√≠vel</span>
          {{ end }}
        </div>
        <div class="pokemon-card__body">
          <div class="pokemon-card__header">
            <h2 class="pokemon-card__title">{{ .name }}</h2>
            <span class="pokemon-card__price {{ if not (or .price .valor) }}pokemon-card__price--tbd{{ end }}">
              {{ if .price }}{{ .price }}{{ else if .valor }}{{ .valor }}{{ else }}Valor a definir{{ end }}
            </span>
          </div>
          <p class="pokemon-card__id">#{{ printf "%03d" $id }}</p>
          <a href="https://wa.me/{{ $whatsapp }}?text=Ol√°! Vi o Pok√©mon {{ .name }} no teu site üôÇ" class="btn btn-whatsapp" target="_blank" rel="noopener">Contactar no WhatsApp</a>
        </div>
      </article>
    {{ end }}
  </div>
</section>
{{ end }}

<section class="container intro">
  {{ .Content }}
</section>
{{ end }}
